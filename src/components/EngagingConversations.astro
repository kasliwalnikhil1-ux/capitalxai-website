---
interface TabContent {
  id: string;
  label: string;
  icon: string;
  messages: string[];
  gif?: string;
  image?: string;
}

interface Props {
  title?: string;
  subheading?: string;
  tabs?: TabContent[];
}

const { 
  title = 'Engaging conversations',
  subheading = 'Tailor each message to an investor\'s interests, portfolio, and activity to secure more meetings and close your round faster.',
  tabs = []
} = Astro.props;

const defaultTabs: TabContent[] = [
  {
    id: 'twitter-linkedin-post',
    label: 'Twitter/LinkedIn post',
    icon: 'person-square',
    messages: [
      'Hey Danny, I just read your tweet about the Elon Musk interview — great insights on AI in business!',
      'Hey Steve, I just read your LinkedIn post about Amex topping the Best Workplaces in New York list — congrats!'
    ],
    gif: '/twitterlinkedin post.gif',
    image: '/twitter_linkedin_post.png'
  },
  {
    id: 'linkedin-profile',
    label: 'LinkedIn profile',
    icon: 'profile',
    messages: [
      'Hi Sani, I was impressed by your publications spanning civil arbitration, orthopedics, and biomarkers in chronic fatigue syndrome.',
      'Hi Chris, I was impressed by your leadership in fostering corporate citizenship and education through volunteer roles.'
    ],
    gif: '/linkedin profile.gif',
    image: '/linkedin_profile.png'
  },
  {
    id: 'investor-focus',
    label: 'Investor focus',
    icon: 'people',
    messages: [
      'Hey James, I\'d love to work with Initialized for your expertise in portfolio companies such as Career Karma and Reddit.',
      'Hey Mark, your experience in leading strategy and operations at Mint can significantly boost our growth trajectory.'
    ],
    gif: '/investor.gif',
    image: '/investor_focus.png'
  },
  {
    id: 'shared-experiences',
    label: 'Shared experiences',
    icon: 'overlap',
    messages: [
      'Hi John, I saw that we both graduated from Stanford\'s Business School. It\'s always great to connect with a fellow Cardinal!',
      'Hi Gary, I couldn\'t help but notice that we both worked at Microsoft in the past. It\'s always great to connect with fellow alumni.'
    ],
    gif: '/shared.gif',
    image: '/shared_experiences.png'
  },
];

const items = tabs?.length > 0 ? tabs : defaultTabs;
---

<section class="engaging-conversations" aria-labelledby="engaging-title">
  <div class="container">
    <h2 id="engaging-title" class="engaging-title">{title}</h2>
    {subheading && <p class="engaging-subheading">{subheading}</p>}
    
    <!-- Tabs Navigation -->
    <div class="tabs-nav" role="tablist">
      {items.map((tab, index) => (
        <button
          class={`tab-button ${index === 0 ? 'active' : ''}`}
          role="tab"
          aria-selected={index === 0}
          aria-controls={`panel-${tab.id}`}
          id={`tab-${tab.id}`}
          data-tab={tab.id}
        >
          {tab.label}
        </button>
      ))}
    </div>

    <!-- Tab Panels -->
    <div class="tabs-content">
      {items.map((tab, index) => (
        <div
          class={`tab-panel ${index === 0 ? 'active' : ''}`}
          id={`panel-${tab.id}`}
          role="tabpanel"
          aria-labelledby={`tab-${tab.id}`}
          data-panel={tab.id}
        >
          <div class={`content-card ${tab.id === 'linkedin-profile' ? 'content-card-framed' : ''}`}>
            <!-- Left Panel: Text Content -->
            <div class="content-left">
              <div class="content-header">
                <div class="content-icon" aria-hidden="true">
                  {tab.icon === 'person-square' && (
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="1.5"/>
                      <circle cx="9" cy="9" r="2" stroke="currentColor" stroke-width="1.5"/>
                      <path d="M3 19C3 16 6 14 9 14C12 14 15 16 15 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                  )}
                  {tab.icon === 'profile' && (
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="12" cy="8" r="3" stroke="currentColor" stroke-width="1.5"/>
                      <path d="M6 21C6 17 8.5 14 12 14C15.5 14 18 17 18 21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                  )}
                  {tab.icon === 'people' && (
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="9" cy="7" r="3" stroke="currentColor" stroke-width="1.5"/>
                      <circle cx="15" cy="7" r="3" stroke="currentColor" stroke-width="1.5"/>
                      <path d="M3 21C3 17 5.5 14 9 14C12.5 14 15 17 15 21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                      <path d="M9 21C9 17 11.5 14 15 14C18.5 14 21 17 21 21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                  )}
                  {tab.icon === 'overlap' && (
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect x="3" y="3" width="12" height="12" rx="2" stroke="currentColor" stroke-width="1.5"/>
                      <rect x="9" y="9" width="12" height="12" rx="2" stroke="currentColor" stroke-width="1.5" opacity="0.7"/>
                    </svg>
                  )}
                </div>
                <h3 class="content-title">{tab.label}</h3>
              </div>
              <div class="content-messages">
                {tab.messages.map((message) => (
                  <p class="message-text">{message}</p>
                ))}
              </div>
            </div>

            <!-- Right Panel: GIF Area -->
            <div class="content-right">
              <div 
                class="gif-container" 
                style={`--mask-url: url("${String(tab.gif || tab.image || '/twitter_linkedin_post.png').replace(/"/g, '\\"')}")`}
              >
                <img 
                  src={encodeURI(tab.gif || tab.image || '/twitter_linkedin_post.png')} 
                  alt={`${tab.label} demonstration`}
                  class="content-gif"
                  loading="eager"
                  decoding="async"
                />
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  // Tab switching functionality
  document.addEventListener('DOMContentLoaded', () => {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanels = document.querySelectorAll('.tab-panel');

    tabButtons.forEach((button) => {
      button.addEventListener('click', () => {
        const tabId = button.getAttribute('data-tab');

        // Remove active class from all buttons and panels
        tabButtons.forEach((btn) => {
          btn.classList.remove('active');
          btn.setAttribute('aria-selected', 'false');
        });
        tabPanels.forEach((panel) => {
          panel.classList.remove('active');
        });

        // Add active class to clicked button and corresponding panel
        button.classList.add('active');
        button.setAttribute('aria-selected', 'true');
        const targetPanel = document.querySelector(`[data-panel="${tabId}"]`);
        if (targetPanel) {
          targetPanel.classList.add('active');
        }
      });
    });
  });
</script>

<style>
  .engaging-conversations {
    padding-block: 5rem 6rem;
    background: #0b1020; /* Match homepage color theme */
  }

  .engaging-title {
    margin: 0 0 1.25rem;
    font-size: clamp(2rem, 5vw, 3rem);
    font-weight: 700;
    text-align: center;
    letter-spacing: -0.02em;
    color: rgba(255, 255, 255, 0.98);
  }

  .engaging-subheading {
    margin: 0 auto 3.5rem;
    max-width: 56rem;
    font-size: clamp(1rem, 2vw, 1.25rem);
    text-align: center;
    color: rgba(255, 255, 255, 0.75);
    line-height: 1.7;
  }

  /* Tabs Navigation */
  .tabs-nav {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .tab-button {
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.9);
    background: transparent;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
  }

  .tab-button:hover {
    background: rgba(255, 255, 255, 0.05);
  }

  .tab-button.active {
    background: rgba(255, 255, 255, 0.98);
    color: rgba(0, 0, 0, 0.9);
    font-weight: 600;
  }

  /* Tab Panels */
  .tabs-content {
    position: relative;
    min-height: 500px;
  }

  .tab-panel {
    display: none;
    animation: fadeIn 0.3s ease;
  }

  .tab-panel.active {
    display: block;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Content Card - All cards same size */
  .content-card {
    background: rgba(22, 30, 52, 0.8); /* #161E34 - slightly lighter dark blue-grey */
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 12px;
    padding: 2.5rem;
    display: grid;
    grid-template-columns: 1fr 1.2fr;
    gap: 2.5rem;
    align-items: start;
    min-height: 450px;
    box-sizing: border-box;
  }

  /* LinkedIn Profile Card Frame - Only visual difference, same size */
  .content-card-framed {
    border: 2px solid rgba(255, 255, 255, 0.15);
    box-shadow: 
      0 0 0 1px rgba(255, 255, 255, 0.05),
      0 4px 20px rgba(0, 0, 0, 0.4);
  }

  /* Left Panel */
  .content-left {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .content-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .content-icon {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255, 255, 255, 0.9);
    flex-shrink: 0;
  }

  .content-icon svg {
    width: 100%;
    height: 100%;
  }

  .content-title {
    margin: 0;
    font-size: clamp(1.25rem, 2.5vw, 1.5rem);
    font-weight: 700;
    color: rgba(255, 255, 255, 0.98);
    line-height: 1.3;
  }

  .content-messages {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }

  .message-text {
    margin: 0;
    font-size: clamp(0.9375rem, 1.8vw, 1.0625rem);
    color: rgba(255, 255, 255, 0.85);
    line-height: 1.7;
  }

  /* Right Panel - GIF Container */
  .content-right {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .gif-container {
    width: 100%;
    max-width: 100%;
    border-radius: 8px;
    overflow: hidden;
    background: transparent;
    position: relative;
  }

  .gif-container::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.45) 0%, rgba(0, 0, 0, 0.18) 45%, transparent 100%);
    pointer-events: none;
    border-radius: 8px;
    -webkit-mask-image: var(--mask-url);
    mask-image: var(--mask-url);
    -webkit-mask-size: cover;
    mask-size: cover;
    -webkit-mask-position: center;
    mask-position: center;
    -webkit-mask-repeat: no-repeat;
    mask-repeat: no-repeat;
    -webkit-mask-mode: alpha;
    mask-mode: alpha;
  }

  .content-gif {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 8px;
    object-fit: contain;
  }

  @media (max-width: 1024px) {
    .content-card {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    .content-right {
      order: -1; /* Show GIF first on mobile */
    }
  }

  @media (max-width: 768px) {
    .engaging-conversations {
      padding-block: 4rem 5rem;
    }

    .engaging-subheading {
      margin-bottom: 2.5rem;
    }

    .tabs-nav {
      gap: 0.25rem;
    }

    .tab-button {
      padding: 0.625rem 1rem;
      font-size: 0.875rem;
    }

    .content-card {
      padding: 2rem 1.5rem;
    }
  }
</style>
