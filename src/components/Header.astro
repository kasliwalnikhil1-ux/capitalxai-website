---
interface Props {
  siteName?: string;
  logoHref?: string;
}

const { siteName = 'CapitalxAI', logoHref = '/' } = Astro.props;
---

<header class="header" id="site-header">
  <div class="container header-inner">
    <a href={logoHref} class="brand" aria-label={`${siteName} home`}>
      <span class="brand-mark" aria-hidden="true">
        <img src="/capitalxai-logo.png" alt="" width="34" height="34" loading="eager" decoding="async" />
      </span>
      <span class="brand-text-block">
        <span class="brand-text">{siteName}</span>
        <span class="brand-tagline">AI-powered fundraising</span>
      </span>
    </a>

    <nav class="nav" aria-label="Main">
      <a href="https://docs.capitalxai.com/" class="nav-link" target="_blank" rel="noopener noreferrer">Product Tour</a>
      <a href="/vision" class="nav-link">Vision</a>
      <a href="/pricing" class="nav-link">Pricing</a>
    </nav>

    <div class="actions" aria-label="Header actions">
      <a class="btn btn-outline" href="https://app.capitalxai.com/signup" target="_blank" rel="noopener noreferrer">Login</a>
      <a class="btn btn-solid" href="https://calendly.com/founders-capitalxai/20min" target="_blank" rel="noopener noreferrer">Start fundraising<span class="btn-arrow" aria-hidden="true">&rarr;</span></a>
    </div>

    <button
      type="button"
      class="hamburger"
      aria-label="Open menu"
      aria-expanded="false"
      aria-controls="mobile-menu"
      id="hamburger-btn"
    >
      <span class="hamburger-bar" aria-hidden="true"></span>
      <span class="hamburger-bar" aria-hidden="true"></span>
      <span class="hamburger-bar" aria-hidden="true"></span>
    </button>
  </div>

  <div
    class="mobile-menu"
    id="mobile-menu"
    role="dialog"
    aria-label="Mobile navigation"
    aria-modal="true"
    hidden
  >
    <nav class="mobile-nav" aria-label="Main">
      <a href="https://docs.capitalxai.com/" class="mobile-nav-link" target="_blank" rel="noopener noreferrer">Product Tour</a>
      <a href="/vision" class="mobile-nav-link">Vision</a>
      <a href="/pricing" class="mobile-nav-link">Pricing</a>
    </nav>
    <div class="mobile-actions">
      <a class="btn btn-outline mobile-btn" href="https://app.capitalxai.com/signup" target="_blank" rel="noopener noreferrer">Login</a>
      <a class="btn btn-solid mobile-btn" href="https://calendly.com/founders-capitalxai/20min" target="_blank" rel="noopener noreferrer">Start fundraising</a>
    </div>
  </div>
</header>

<script>
  const header = document.getElementById('site-header');
  const hamburger = document.getElementById('hamburger-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileLinks = document.querySelectorAll('.mobile-nav-link, .mobile-actions .btn');
  const mobileQuery = window.matchMedia('(max-width: 860px)');

  // On mobile the header is position:fixed, so add body padding to compensate
  function applyFixedPadding() {
    if (mobileQuery.matches && header) {
      document.body.style.paddingTop = header.offsetHeight + 'px';
    } else {
      document.body.style.paddingTop = '';
    }
  }
  applyFixedPadding();
  mobileQuery.addEventListener('change', applyFixedPadding);
  window.addEventListener('resize', applyFixedPadding);

  function openMenu() {
    hamburger?.setAttribute('aria-expanded', 'true');
    hamburger?.setAttribute('aria-label', 'Close menu');
    mobileMenu?.removeAttribute('hidden');
    header?.classList.add('menu-open');
    document.body.style.overflow = 'hidden';
  }

  function closeMenu() {
    hamburger?.setAttribute('aria-expanded', 'false');
    hamburger?.setAttribute('aria-label', 'Open menu');
    mobileMenu?.setAttribute('hidden', '');
    header?.classList.remove('menu-open');
    document.body.style.overflow = '';
  }

  function toggleMenu() {
    const isOpen = hamburger?.getAttribute('aria-expanded') === 'true';
    if (isOpen) closeMenu();
    else openMenu();
  }

  hamburger?.addEventListener('click', toggleMenu);

  mobileLinks.forEach((link) => {
    link.addEventListener('click', () => closeMenu());
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeMenu();
  });

  mobileQuery.addEventListener('change', (e) => {
    if (!e.matches) closeMenu();
  });
</script>

<style>
  .header {
    position: -webkit-sticky;
    position: sticky;
    top: 0;
    z-index: 100;
    --header-bg: #0b1020;
    padding-block: 1.15rem;
    background: linear-gradient(180deg, #0b1020 0%, #0b1020 60%, rgba(11, 16, 32, 0.92) 100%);
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
  }

  .header-inner {
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    column-gap: 2.25rem;
  }

  .brand {
    display: inline-flex;
    align-items: center;
    gap: 0.65rem;
    min-width: max-content;
  }

  .brand-mark {
    width: 34px;
    height: 34px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .brand-text-block {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 0.1rem;
  }

  .brand-text {
    font-size: 2rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    line-height: 1;
    color: rgba(255, 255, 255, 0.96);
  }

  .brand-tagline {
    font-size: 0.7rem;
    font-weight: 500;
    letter-spacing: 0.02em;
    line-height: 1;
    color: rgba(255, 255, 255, 0.55);
  }

  .brand:hover {
    opacity: 0.95;
  }

  .nav {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2.75rem;
  }

  .nav-link {
    font-size: 1.25rem;
    font-weight: 500;
    letter-spacing: -0.01em;
    color: rgba(255, 255, 255, 0.82);
    transition: opacity var(--transition), color var(--transition);
  }

  .nav-link:hover {
    color: rgba(255, 255, 255, 0.92);
  }

  .actions {
    display: flex;
    align-items: center;
    gap: 1.25rem;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 46px;
    padding: 0 1.25rem;
    border-radius: 999px;
    font-size: 1.1rem;
    font-weight: 600;
    letter-spacing: -0.01em;
    white-space: nowrap;
    user-select: none;
    transition: transform var(--transition), background var(--transition), border-color var(--transition), opacity var(--transition);
  }

  .btn-outline {
    background: rgba(0, 0, 0, 0.08);
    border: 1.5px solid rgba(255, 255, 255, 0.45);
    color: rgba(255, 255, 255, 0.92);
    box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.18);
  }

  .btn-solid {
    background: rgba(117, 126, 146, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.12);
    color: rgba(255, 255, 255, 0.96);
    box-shadow: 0 10px 24px rgba(0, 0, 0, 0.22);
  }

  .btn-arrow {
    font-size: 1.15em;
    opacity: 0.9;
    transition: transform 0.2s ease;
  }

  .btn:hover .btn-arrow {
    transform: translateX(2px);
  }

  .btn:hover {
    transform: translateY(-1px);
    opacity: 0.98;
  }

  .btn:active {
    transform: translateY(0px);
  }

  /* Hamburger: hidden on desktop */
  .hamburger {
    display: none;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    padding: 0;
    margin: 0;
    background: transparent;
    border: none;
    cursor: pointer;
    color: rgba(255, 255, 255, 0.9);
    border-radius: 8px;
    flex-direction: column;
    gap: 5px;
    transition: background 0.2s, color 0.2s;
    -webkit-tap-highlight-color: transparent;
  }

  .hamburger:hover {
    background: rgba(255, 255, 255, 0.08);
  }

  .hamburger-bar {
    display: block;
    width: 22px;
    height: 2.5px;
    background: currentColor;
    border-radius: 2px;
    transition: transform 0.25s ease, opacity 0.2s ease;
  }

  .header.menu-open .hamburger-bar:nth-child(1) {
    transform: translateY(7.5px) rotate(45deg);
  }

  .header.menu-open .hamburger-bar:nth-child(2) {
    opacity: 0;
  }

  .header.menu-open .hamburger-bar:nth-child(3) {
    transform: translateY(-7.5px) rotate(-45deg);
  }

  /* Mobile menu: off-screen above, slides down from top */
  .mobile-menu {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: #0b1020;
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    padding: 1rem 1.5rem 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-8px);
    transition: max-height 0.3s ease, opacity 0.25s ease, transform 0.25s ease, visibility 0.25s;
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.35);
  }

  .header.menu-open .mobile-menu {
    max-height: 80vh;
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .mobile-menu[hidden] {
    display: flex !important;
  }

  .mobile-nav {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .mobile-nav-link {
    display: block;
    padding: 0.85rem 0.75rem;
    font-size: 1.2rem;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.88);
    border-radius: 10px;
    transition: background 0.2s, color 0.2s;
  }

  .mobile-nav-link:hover {
    background: rgba(255, 255, 255, 0.08);
    color: rgba(255, 255, 255, 0.98);
  }

  .mobile-actions {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-top: 0.25rem;
    padding-top: 0.75rem;
  }

  .mobile-actions .btn {
    width: 100%;
    justify-content: center;
  }

  @media (min-width: 861px) {
    .mobile-menu {
      display: none !important;
    }
  }

  @media (max-width: 860px) {
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      border-bottom: none;
      background: #0b1020;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
    }

    .brand-mark {
      width: 26px;
      height: 26px;
    }

    .brand-mark img {
      width: 26px;
      height: 26px;
    }

    .brand-text {
      font-size: 1.35rem;
    }

    .brand-tagline {
      font-size: 0.6rem;
    }

    .nav,
    .actions {
      display: none;
    }

    .btn-arrow {
      display: none;
    }

    .header-inner {
      grid-template-columns: 1fr auto;
      justify-items: start;
    }

    .hamburger {
      display: flex;
      justify-self: end;
    }
  }
</style>
